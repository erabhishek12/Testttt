<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Visitor Counter â€¢ Demo</title>
<style>
  :root{
    --accent:#FF6B35;
  }
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Devanagari", Arial, sans-serif;
    margin:0; padding:0;
    min-height:100vh; display:grid; place-items:center;
    background: radial-gradient(1000px 600px at 50% -10%, #fff 0%, #f6f6f8 40%, #ececf2 100%);
  }
  .vc-box{
    text-align:center;
    background:rgba(255,255,255,.6);
    backdrop-filter: blur(10px);
    border:2px solid rgba(255,107,53,.35);
    border-radius:18px;
    padding:26px 40px;
    box-shadow:0 14px 36px rgba(0,0,0,.15);
  }
  .vc-title{
    font-size:14px; font-weight:800; letter-spacing:.4px;
    text-transform:uppercase; color:#444; margin-bottom:6px;
  }
  .vc-number{
    font-size:56px; font-weight:900; color:var(--accent);
    text-shadow:0 6px 14px rgba(255,107,53,.35);
    min-width:5ch; display:inline-block;
  }
  .vc-note{
    display:none; opacity:.7; font-size:12px; margin-top:6px;
  }
  @media (max-width:480px){
    .vc-box{ padding:20px 26px }
    .vc-number{ font-size:44px }
  }
</style>
</head>
<body>

<!-- Visitor Counter -->
<div class="vc-box" aria-live="polite">
  <div class="vc-title">Total Visitors</div>
  <div class="vc-number" id="vcNumber">0</div>
  <div class="vc-note" id="vcNote">(cached view)</div>
</div>

<script>
(function(){
  // ========= CONFIG =========
  // Use ONLY letters, numbers, underscores. Make it unique for YOUR site.
  const NAMESPACE = "nazaranaenterprises_shop";
  // Single site-wide counter key. For per-page counters, use location.pathname.
  const KEY = "site_total";
  // ==========================

  const numEl  = document.getElementById('vcNumber');
  const noteEl = document.getElementById('vcNote');

  function animateTo(finalValue, duration=900){
    finalValue = Math.max(0, Number(finalValue)||0);
    const start = performance.now();
    const ease = t => 1 - Math.pow(1 - t, 3); // easeOutCubic
    function frame(now){
      const p = Math.min(1, (now - start)/duration);
      const val = Math.round(finalValue * ease(p));
      numEl.textContent = val.toLocaleString('en-IN');
      if(p < 1) requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }

  // cache keys
  const sessionKey  = `vc_counted_${KEY}`;
  const cachedKey   = `vc_last_value_${KEY}`;
  const already     = sessionStorage.getItem(sessionKey);

  // endpoints
  const base = "https://api.countapi.xyz";
  const enc  = s => encodeURIComponent(s);
  const CREATE = `${base}/create?namespace=${enc(NAMESPACE)}&key=${enc(KEY)}&value=0`;
  const GET    = `${base}/get/${enc(NAMESPACE)}/${enc(KEY)}`;
  const HIT    = `${base}/hit/${enc(NAMESPACE)}/${enc(KEY)}`;

  // show from cache if network blocked
  function showCached(){
    const v = Number(localStorage.getItem(cachedKey) || 0);
    if (v > 0) {
      animateTo(v, 500);
      noteEl.style.display = 'block';
    } else {
      numEl.textContent = "0";
    }
  }

  // Step 1: try to create (idempotent). Ignore failure.
  fetch(CREATE, {mode:'cors'}).finally(() => {
    // Step 2: hit (if not counted this session) else get.
    const url = already ? GET : HIT;
    fetch(url, {cache:'no-store', mode:'cors'})
      .then(r => r.json())
      .then(d => {
        const val = (d && typeof d.value === 'number') ? d.value : 0;
        localStorage.setItem(cachedKey, String(val));
        animateTo(val);
        if (!already) sessionStorage.setItem(sessionKey, '1');
      })
      .catch(() => {
        // Fallback to cached if API blocked by ad-block or offline
        showCached();
      });
  });
})();
</script>

</body>
</html>
